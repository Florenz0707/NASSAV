# NASSAV - AV èµ„æºç®¡ç†ç³»ç»Ÿ

ä¸€ä¸ªå…¨æ ˆè§†é¢‘èµ„æºç®¡ç†ç³»ç»Ÿï¼Œæ”¯æŒå¤šæºèµ„æºè·å–ã€å…ƒæ•°æ®åˆ®å‰Šã€å¼‚æ­¥ä¸‹è½½é˜Ÿåˆ—ä»¥åŠç°ä»£åŒ–çš„ Web ç•Œé¢ç®¡ç†ã€‚

> **åŸä»“åº“**ï¼šæœ¬é¡¹ç›®åŸºäº [Satoing/NASSAV](https://github.com/Satoing/NASSAV) é‡æ„å¼€å‘ï¼ŒåŸé¡¹ç›®ä¿ç•™åœ¨ `origin_project/` ç›®å½•ä¸‹ã€‚

## é¡¹ç›®æ¦‚è§ˆ

NASSAV æ˜¯ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„è§†é¢‘èµ„æºç®¡ç†ç³»ç»Ÿï¼ŒåŒ…æ‹¬ï¼š

- **åç«¯æœåŠ¡**ï¼ˆDjango + Celeryï¼‰ï¼šæä¾› RESTful APIã€å¼‚æ­¥ä¸‹è½½é˜Ÿåˆ—ã€å…ƒæ•°æ®ç®¡ç†
- **å‰ç«¯åº”ç”¨**ï¼ˆVue 3 + Viteï¼‰ï¼šç°ä»£åŒ–çš„ Web ç•Œé¢ï¼Œæ”¯æŒèµ„æºæµè§ˆã€æœç´¢ã€ä¸‹è½½ç®¡ç†
- **åŸé¡¹ç›®**ï¼šåŸå§‹ Python å®ç°ï¼Œä½œä¸ºå‚è€ƒä¿ç•™

## åŠŸèƒ½ç‰¹æ€§

### ğŸ¬ æ ¸å¿ƒåŠŸèƒ½

- **å¤šæºèµ„æºè·å–**ï¼šæ”¯æŒ 8+ è§†é¢‘æºï¼ˆJableã€MissAVã€Netflavã€Kanavã€Kissavã€Memoã€Hohojã€Avtodayï¼‰ï¼Œè‡ªåŠ¨æŒ‰æƒé‡éå†è·å–
- **å…ƒæ•°æ®åˆ®å‰Š**ï¼šä» JavBus ç­‰ç«™ç‚¹è·å–è¯¦ç»†ä¿¡æ¯ï¼ˆå‘è¡Œæ—¥æœŸã€æ¼”å‘˜ã€ç±»åˆ«ã€å°é¢ç­‰ï¼‰
- **å¼‚æ­¥ä¸‹è½½é˜Ÿåˆ—**ï¼šåŸºäº Celery çš„å¼‚æ­¥ä»»åŠ¡ç³»ç»Ÿï¼Œæ”¯æŒ M3U8 æµåª’ä½“ä¸‹è½½
- **æ™ºèƒ½å»é‡æœºåˆ¶**ï¼šå¤šå±‚å»é‡æ£€æŸ¥ï¼ˆRedis é” + Celery é˜Ÿåˆ—ï¼‰ï¼Œç¡®ä¿åŒä¸€èµ„æºä¸é‡å¤ä¸‹è½½
- **å…¨å±€ä¸‹è½½é”**ï¼šç¡®ä¿åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªä¸‹è½½ä»»åŠ¡æ‰§è¡Œï¼Œé¿å…èµ„æºç«äº‰
- **èµ„æºç®¡ç†**ï¼šæŒ‰ AVID åˆ†ç›®å½•å­˜å‚¨ï¼Œç»Ÿä¸€ç®¡ç†è§†é¢‘æ–‡ä»¶ã€å°é¢ã€å…ƒæ•°æ®

### ğŸ–¥ï¸ å‰ç«¯ç•Œé¢

- **èµ„æºæµè§ˆ**ï¼šå¡ç‰‡å¼å±•ç¤ºï¼Œæ”¯æŒæœç´¢ã€è¿‡æ»¤ã€æ’åº
- **èµ„æºè¯¦æƒ…**ï¼šæŸ¥çœ‹å®Œæ•´å…ƒæ•°æ®ï¼Œä¸€é”®ä¸‹è½½æˆ–åˆ·æ–°
- **æ·»åŠ èµ„æº**ï¼šé€‰æ‹©ä¸‹è½½æºæ·»åŠ æ–°èµ„æºï¼Œå®æ—¶æŸ¥çœ‹å¤„ç†çŠ¶æ€
- **ä¸‹è½½ç®¡ç†**ï¼šæŸ¥çœ‹å·²ä¸‹è½½æ¸…å•ï¼Œå¿«é€Ÿå®šä½æœ¬åœ°æ–‡ä»¶
- **Cookie ç®¡ç†**ï¼šä¸ºéœ€è¦è®¤è¯çš„ä¸‹è½½æºè®¾ç½® Cookie

## é¡µé¢é¢„è§ˆ

### é¦–é¡µ
å±•ç¤ºèµ„æºæ€»è§ˆç»Ÿè®¡ã€æœ€è¿‘æ·»åŠ çš„èµ„æºä»¥åŠå¿«æ·æ“ä½œå…¥å£ã€‚

![é¦–é¡µ](vue_frontend/public/home.png)

### èµ„æºåº“
æ”¯æŒæŒ‰ AVID/æ ‡é¢˜/æ¥æºæœç´¢ï¼ŒæŒ‰çŠ¶æ€è¿‡æ»¤ï¼ŒæŒ‰æ—¥æœŸ/ç¼–å·/æ¥æºæ’åºï¼Œæä¾›æ‰¹é‡æ“ä½œã€‚

![èµ„æºåº“](vue_frontend/public/resource.png)

### èµ„æºè¯¦æƒ…
å±•ç¤ºå®Œæ•´çš„å…ƒæ•°æ®ä¿¡æ¯ï¼ŒåŒ…æ‹¬å°é¢ã€æ¼”å‘˜ã€ç±»åˆ«ã€æ–‡ä»¶å¤§å°ç­‰ï¼Œæ”¯æŒä¸‹è½½å’Œåˆ·æ–°æ“ä½œã€‚

![èµ„æºè¯¦æƒ…](vue_frontend/public/resourceDetail.png)

### æ·»åŠ èµ„æº
è¾“å…¥ AVID å¹¶é€‰æ‹©ä¸‹è½½æºï¼Œå®æ—¶æ˜¾ç¤ºå°é¢ä¸‹è½½ã€å…ƒæ•°æ®ä¿å­˜ã€ä¿¡æ¯åˆ®å‰ŠçŠ¶æ€ã€‚

![æ·»åŠ èµ„æº](vue_frontend/public/addResource.png)

### ä¸‹è½½ç®¡ç†
æŸ¥çœ‹å·²ä¸‹è½½çš„èµ„æºåˆ—è¡¨ï¼Œå¿«é€Ÿè·³è½¬åˆ°èµ„æºè¯¦æƒ…é¡µã€‚

![ä¸‹è½½ç®¡ç†](vue_frontend/public/downloads.png)

## æŠ€æœ¯æ ˆ

### åç«¯ï¼ˆdjango_backend/ï¼‰

| ç»„ä»¶ | ç‰ˆæœ¬ | è¯´æ˜ |
|------|------|------|
| Python | 3.12+ | è¿è¡Œç¯å¢ƒ |
| Django | 5.1+ | Web æ¡†æ¶ |
| Django REST Framework | 3.15+ | API æ¡†æ¶ |
| Celery | 5.4+ | å¼‚æ­¥ä»»åŠ¡é˜Ÿåˆ— |
| Redis | - | æ¶ˆæ¯é˜Ÿåˆ— & åˆ†å¸ƒå¼é” |
| curl_cffi | - | HTTP è¯·æ±‚ï¼ˆç»•è¿‡åçˆ¬ï¼‰ |
| N_m3u8DL-RE | - | M3U8 ä¸‹è½½å·¥å…· |

### å‰ç«¯ï¼ˆvue_frontend/ï¼‰

| ç»„ä»¶ | ç‰ˆæœ¬ | è¯´æ˜ |
|------|------|------|
| Vue 3 | - | å‰ç«¯æ¡†æ¶ |
| Vite | 5+ | æ„å»ºå·¥å…· |
| Pinia | - | çŠ¶æ€ç®¡ç† |
| Vue Router | - | è·¯ç”±ç®¡ç† |
| Axios | - | HTTP è¯·æ±‚ |

## é¡¹ç›®ç»“æ„

```
NASSAV/
â”œâ”€â”€ django_backend/          # Django åç«¯æœåŠ¡
â”‚   â”œâ”€â”€ config/             # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ django_project/     # Django é¡¹ç›®é…ç½®
â”‚   â”œâ”€â”€ nassav/             # ä¸»åº”ç”¨
â”‚   â”‚   â”œâ”€â”€ m3u8downloader/ # M3U8 ä¸‹è½½å™¨
â”‚   â”‚   â”œâ”€â”€ scraper/        # å…ƒæ•°æ®åˆ®å‰Šå™¨
â”‚   â”‚   â””â”€â”€ source/         # 8 ä¸ªä¸‹è½½æº
â”‚   â”œâ”€â”€ resource/           # èµ„æºå­˜å‚¨ç›®å½•
â”‚   â”‚   â””â”€â”€ {AVID}/        # æŒ‰ AVID åˆ†ç›®å½•
â”‚   â”‚       â”œâ”€â”€ {AVID}.html
â”‚   â”‚       â”œâ”€â”€ {AVID}.jpg
â”‚   â”‚       â”œâ”€â”€ {AVID}.json
â”‚   â”‚       â””â”€â”€ {AVID}.mp4
â”‚   â””â”€â”€ tools/              # N_m3u8DL-RE å·¥å…·
â”œâ”€â”€ vue_frontend/           # Vue å‰ç«¯åº”ç”¨
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ views/         # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ components/    # é€šç”¨ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ api/          # API å°è£…
â”‚   â”‚   â”œâ”€â”€ stores/       # Pinia çŠ¶æ€
â”‚   â”‚   â””â”€â”€ router/       # è·¯ç”±é…ç½®
â”‚   â””â”€â”€ public/           # é™æ€èµ„æº
â””â”€â”€ origin_project/         # åŸå§‹é¡¹ç›®ï¼ˆä¿ç•™ï¼‰
```

## å¿«é€Ÿå¼€å§‹

### å‰ç½®è¦æ±‚

- Python 3.12+
- Node.js 18+
- Redis
- pnpmï¼ˆæ¨èï¼‰æˆ– npm

### 1. åç«¯è®¾ç½®

#### å®‰è£…ä¾èµ–

```bash
cd django_backend
uv sync  # æˆ– pip install -r requirements.txt
```

#### é…ç½®æ–‡ä»¶

```bash
cp config/template-config.yaml config/config.yaml
# ç¼–è¾‘ config.yamlï¼Œé…ç½®ä»£ç†ã€åˆ®å‰Šå™¨ã€ä¸‹è½½æºç­‰
```

#### ä¸‹è½½å·¥å…·

ä¸‹è½½ [N_m3u8DL-RE](https://github.com/nilaoda/N_m3u8DL-RE/releases) å¹¶æ”¾ç½®åˆ° `tools/` ç›®å½•ï¼š

```bash
mkdir -p tools
# ä¸‹è½½å¯¹åº”å¹³å°çš„ N_m3u8DL-RE å¹¶æ”¾å…¥ tools/
chmod +x tools/N_m3u8DL-RE  # Linux/macOS
```

#### å¯åŠ¨ Redis

```bash
# Ubuntu/Debian
sudo systemctl start redis

# macOS
brew services start redis

# Windows
# ä½¿ç”¨ WSL æˆ–ä¸‹è½½ Windows ç‰ˆ Redis
```

#### å¯åŠ¨æœåŠ¡

```bash
# å¯åŠ¨ Django æœåŠ¡ï¼ˆç«¯å£ 8000ï¼‰
uv run python manage.py runserver 0.0.0.0:8000

# å¯åŠ¨ Celery Workerï¼ˆæ–°ç»ˆç«¯ï¼‰
uv run celery -A django_project worker -l info
```

### 2. å‰ç«¯è®¾ç½®

#### å®‰è£…ä¾èµ–

```bash
cd vue_frontend
pnpm install  # æˆ– npm install
```

#### å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
pnpm dev  # é»˜è®¤ç«¯å£ 8080
```

å¼€å‘ä»£ç†å·²é…ç½®ï¼š`/nassav` â†’ `http://localhost:8000`

### 3. è®¿é—®åº”ç”¨

æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼šhttp://localhost:8080

## API æ–‡æ¡£

è¯¦ç»†æ¥å£è¯´æ˜è¯·å‚è€ƒ [django_backend/interfaces.md](django_backend/interfaces.md)

ä¸»è¦ç«¯ç‚¹ï¼š

| æ–¹æ³• | ç«¯ç‚¹ | è¯´æ˜ |
|------|------|------|
| GET | `/api/source/list` | è·å–å¯ç”¨ä¸‹è½½æºåˆ—è¡¨ |
| POST | `/api/source/cookie` | è®¾ç½®ä¸‹è½½æº Cookie |
| GET | `/api/resource/list` | è·å–æ‰€æœ‰èµ„æºåˆ—è¡¨ |
| GET | `/api/resource/cover` | è·å–å°é¢å›¾ç‰‡ |
| POST | `/api/resource` | æ·»åŠ æ–°èµ„æº |
| POST | `/api/resource/refresh` | åˆ·æ–°èµ„æºå…ƒæ•°æ® |
| GET | `/api/downloads/list` | è·å–å·²ä¸‹è½½åˆ—è¡¨ |
| POST | `/api/downloads` | æäº¤ä¸‹è½½ä»»åŠ¡ |

## ç”Ÿäº§éƒ¨ç½²

### åç«¯éƒ¨ç½²

```bash
# ä½¿ç”¨ uWSGI æˆ– Gunicorn
gunicorn django_project.wsgi:application --bind 0.0.0.0:8000

# Celery Workerï¼ˆåå°è¿è¡Œï¼‰
celery -A django_project worker -l info --detach
```

### å‰ç«¯éƒ¨ç½²

```bash
cd vue_frontend
pnpm build  # æ„å»ºåˆ° dist/
```

ä½¿ç”¨ Nginx éƒ¨ç½²ç¤ºä¾‹ï¼š

```nginx
server {
  listen 80;
  server_name your-domain.com;

  # å‰ç«¯é™æ€æ–‡ä»¶
  root /var/www/nassav/vue_frontend/dist;
  index index.html;

  # SPA è·¯ç”±å›é€€
  location / {
    try_files $uri $uri/ /index.html;
  }

  # API åå‘ä»£ç†
  location /nassav/ {
    proxy_pass http://127.0.0.1:8000/;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
  }
}
```

## å¸¸è§é—®é¢˜

### åç«¯ç›¸å…³

**Q: Celery ä»»åŠ¡é˜Ÿåˆ—ä¸­å‡ºç°é‡å¤ä»»åŠ¡ï¼Ÿ**

A: ç³»ç»Ÿå·²å®ç°å¤šå±‚å»é‡æœºåˆ¶ï¼ˆRedis é” + Celery é˜Ÿåˆ—æ£€æŸ¥ï¼‰ï¼Œæ­£å¸¸æƒ…å†µä¸‹ä¸ä¼šå‡ºç°é‡å¤ã€‚å¦‚æœä»æœ‰é—®é¢˜ï¼Œæ£€æŸ¥ Redis è¿æ¥çŠ¶æ€ã€‚

**Q: ä¸‹è½½ä»»åŠ¡å¡ä½ä¸åŠ¨ï¼Ÿ**

A: æ£€æŸ¥ N_m3u8DL-RE æ˜¯å¦æ­£ç¡®å®‰è£…ï¼ŒæŸ¥çœ‹ Celery Worker æ—¥å¿—ï¼Œç¡®è®¤å…¨å±€ä¸‹è½½é”æ˜¯å¦æ­£å¸¸é‡Šæ”¾ã€‚

**Q: æŸäº›æºæ— æ³•è·å–èµ„æºï¼Ÿ**

A: éƒ¨åˆ†æºéœ€è¦è®¾ç½® Cookieï¼Œåœ¨å‰ç«¯"æ·»åŠ èµ„æº"é¡µé¢çš„ Cookie è®¾ç½®ä¸­é…ç½®ã€‚

### å‰ç«¯ç›¸å…³

**Q: åˆ·æ–°é¡µé¢å‡ºç° 404ï¼Ÿ**

A: SPA åº”ç”¨éœ€è¦é…ç½®æœåŠ¡å™¨å°†æ‰€æœ‰è·¯å¾„å›é€€åˆ° `index.html`ï¼ˆå‚è€ƒä¸Šæ–¹ Nginx é…ç½®ï¼‰ã€‚

**Q: æ¥å£è¯·æ±‚å¤±è´¥æˆ–è·¨åŸŸï¼Ÿ**

A: ç¡®è®¤åç«¯æœåŠ¡æ­£åœ¨è¿è¡Œï¼Œæ£€æŸ¥ä»£ç†é…ç½®æˆ– CORS è®¾ç½®ã€‚

**Q: å¼€å‘ç«¯å£å†²çªï¼Ÿ**

A: ä¿®æ”¹ `vue_frontend/vite.config.js` ä¸­çš„ `server.port`ã€‚

### ä¸‹è½½æºç›¸å…³

**Q: å“ªäº›æºæ¯”è¾ƒå¥½ç”¨ï¼Ÿ**

A: å°±ç›®å‰æ¥è¯´ï¼Œ**missav**å“ç±»æœ€å…¨ä½†æ˜¯éœ€è¦æ‰‹åŠ¨è·å–è®¾ç½®cookieï¼Œjableå…¶æ¬¡å¹¶ä¸”å¯ä»¥è‡ªåŠ¨è·å–cookieï¼Œmemoä¸éœ€è¦è®¾ç½®cookieä½†æ˜¯æ²¡æœ‰ä¸­æ–‡å­—å¹•ï¼Œå…¶ä½™çš„æºç¼ºä¹è‰¯å¥½æ”¯æŒã€‚

## å¼€å‘æŒ‡å—

### æ·»åŠ æ–°çš„ä¸‹è½½æº

1. åœ¨ `django_backend/nassav/source/` åˆ›å»ºæ–°çš„æºç±»ï¼Œç»§æ‰¿ `SourceBase`
2. å®ç° `get_download_info()` æ–¹æ³•
3. åœ¨ `SourceManager` ä¸­æ³¨å†Œæ–°æº
4. åœ¨ `config.yaml` ä¸­é…ç½®æƒé‡

### æ·»åŠ æ–°çš„åˆ®å‰Šå™¨

1. åœ¨ `django_backend/nassav/scraper/` åˆ›å»ºæ–°çš„åˆ®å‰Šå™¨ç±»
2. å®ç°å…ƒæ•°æ®è§£æé€»è¾‘
3. åœ¨ `ScraperManager` ä¸­æ³¨å†Œ

## è®¸å¯è¯

æœ¬é¡¹ç›®åŸºäºåŸä»“åº“ [Satoing/NASSAV](https://github.com/Satoing/NASSAV) é‡æ„å¼€å‘ï¼Œéµå¾ªç›¸åŒçš„è®¸å¯è¯ã€‚

## è‡´è°¢

æ„Ÿè°¢ [Satoing/NASSAV](https://github.com/Satoing/NASSAV) åŸé¡¹ç›®çš„å¯å‘å’ŒåŸºç¡€ä»£ç ã€‚
